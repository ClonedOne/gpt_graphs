python
Copy code
from itertools import permutations

for rank_num, nodes in ranks.items():
    if rank_num == 0:
        continue
    prev_nodes = ranks[rank_num-1]
    min_crossings = float('inf')
    best_perm = nodes
    for perm in permutations(nodes):
        num_crossings = 0
        for i in range(len(prev_nodes)):
            for j in range(len(perm)):
                for k in range(i+1, len(prev_nodes)):
                    for l in range(j+1, len(perm)):
                        source1, target1 = prev_nodes[i], perm[j]
                        source2, target2 = prev_nodes[k], perm[l]
                        if source1 < source2 and target1 > target2:
                            num_crossings += 1
        if num_crossings < min_crossings:
            min_crossings = num_crossings
            best_perm = perm
    ranks[rank_num] = best_perm